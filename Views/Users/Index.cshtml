@model IEnumerable<MNBEMART.Models.User>
@{
    ViewData["Title"] = "Quản lý người dùng";
    var i = 1;
}

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<div class="min-h-screen bg-slate-50 p-6 md:p-8 space-y-6 text-slate-700">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
            <h1 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                <i class="bi bi-people text-blue-600"></i> Quản lý người dùng
            </h1>
            <p class="text-sm text-slate-500">Theo dõi, phân quyền và quản lý tài khoản đăng nhập hệ thống</p>
        </div>

        <a asp-action="Create"
           class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition">
            <i class="bi bi-plus-circle"></i> Thêm người dùng
        </a>
    </div>

    @if (TempData["Msg"] != null)
    {
        <div class="bg-green-50 border border-green-200 text-green-700 text-sm rounded-lg px-4 py-2">
            <i class="bi bi-check-circle-fill me-1"></i> @TempData["Msg"]
        </div>
    }

    <!-- Table -->
    <div class="bg-white border border-slate-200 shadow-sm rounded-xl p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-slate-700">
                <thead class="bg-slate-100 text-slate-600 text-xs uppercase">
                    <tr>
                        <th class="px-3 py-2 text-left">#</th>
                        <th class="px-3 py-2 text-left">Tài khoản</th>
                        <th class="px-3 py-2 text-left">Họ tên</th>
                        <th class="px-3 py-2 text-left">Quyền</th>
                        <th class="px-3 py-2 text-left">Kho được truy cập</th>
                        <th class="px-3 py-2 text-right">Thao tác</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    @foreach (var u in Model)
                    {
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-3 py-2">@i</td>
                            <td class="px-3 py-2 font-medium text-slate-800">@u.Username</td>
                            <td class="px-3 py-2">@u.FullName</td>
                            <td class="px-3 py-2">
                                @if ((u.Role ?? "User").Equals("Admin", StringComparison.OrdinalIgnoreCase))
                                {
                                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-red-100 text-red-700">
                                        <i class="bi bi-shield-lock-fill"></i> Admin
                                    </span>
                                }
                                else
                                {
                                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-slate-100 text-slate-700">
                                        <i class="bi bi-person-fill"></i> User
                                    </span>
                                }
                            </td>
                            <td class="px-3 py-2 text-slate-600">
                                @string.Join(", ", (u.UserWarehouses ?? new List<MNBEMART.Models.UserWarehouse>())
                                    .Select(uw => uw.Warehouse?.Name)
                                    .Where(n => !string.IsNullOrWhiteSpace(n)))
                            </td>
                            <td class="px-3 py-2 text-right">
                                <div class="inline-flex gap-2">
                                    <a asp-action="Edit" asp-route-id="@u.Id"
                                       class="px-3 py-1 rounded-md text-xs font-semibold bg-yellow-100 text-yellow-700 hover:bg-yellow-200 transition">
                                        <i class="bi bi-pencil-square"></i> Sửa
                                    </a>

                                    <form asp-action="ResetPassword" method="post" class="inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@u.Id" />
                                        <input type="hidden" name="newPassword" value="123456" />
                                        <button type="submit"
                                                class="px-3 py-1 rounded-md text-xs font-semibold bg-slate-100 text-slate-700 hover:bg-slate-200 transition"
                                                onclick="return confirm('Đặt lại mật khẩu về 123456 ?');">
                                            <i class="bi bi-arrow-clockwise"></i> Reset MK
                                        </button>
                                    </form>

                                    <form asp-action="Delete" method="post" class="inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@u.Id" />
                                        <button type="submit"
                                                class="px-3 py-1 rounded-md text-xs font-semibold bg-red-100 text-red-700 hover:bg-red-200 transition"
                                                onclick="return confirm('Xoá người dùng này?');">
                                            <i class="bi bi-trash"></i> Xoá
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        i++;
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
