@model List<MNBEMART.Models.LotHistory>
@{
    ViewData["Title"] = "Lịch sử lô hàng";
    var lot = ViewBag.Lot as MNBEMART.Models.StockLot;
}

<div class="max-w-5xl mx-auto px-6 py-8">
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight mb-2">
                    <i class="bi bi-clock-history text-purple-600 me-2"></i>
                    Lịch sử lô hàng
                </h1>
                <p class="text-slate-600">@lot?.LotNumber - @lot?.Material?.Name</p>
            </div>
            <a asp-action="Details" asp-route-id="@lot?.Id" class="bg-slate-600 hover:bg-slate-700 text-white font-medium px-5 py-2.5 rounded-lg transition">
                <i class="bi bi-arrow-left me-1"></i> Quay lại
            </a>
        </div>
    </div>

    @if (Model.Any())
    {
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-8">
            <div class="relative">
                <!-- Timeline line -->
                <div class="absolute left-6 top-0 bottom-0 w-0.5 bg-slate-200"></div>

                <!-- Timeline items -->
                <div class="space-y-8">
                    @foreach (var item in Model)
                    {
                        var (icon, color) = item.Action switch
                        {
                            "Split" => ("bi-scissors", "amber"),
                            "Created from split" => ("bi-plus-circle", "blue"),
                            "Merged" => ("bi-union", "purple"),
                            "Created from merge" => ("bi-plus-circle", "purple"),
                            "Reserved" => ("bi-lock-fill", "amber"),
                            "Released" => ("bi-unlock", "green"),
                            "Issue" => ("bi-arrow-up-circle", "red"),
                            _ => ("bi-circle", "slate")
                        };

                        <div class="relative flex gap-6">
                            <!-- Icon -->
                            <div class="flex-shrink-0 w-12 h-12 rounded-full bg-@(color)-100 border-4 border-white flex items-center justify-center z-10 shadow-sm">
                                <i class="bi @icon text-@(color)-600 text-lg"></i>
                            </div>

                            <!-- Content -->
                            <div class="flex-1 pb-8">
                                <div class="bg-slate-50 rounded-lg p-6 border border-slate-200">
                                    <div class="flex items-start justify-between mb-3">
                                        <h3 class="text-lg font-bold text-slate-900">@item.Action</h3>
                                        <span class="text-xs font-medium text-slate-500 bg-white px-3 py-1 rounded-full">
                                            @item.PerformedAt.ToString("dd/MM/yyyy HH:mm")
                                        </span>
                                    </div>

                                    @if (item.QuantityBefore.HasValue && item.QuantityAfter.HasValue)
                                    {
                                        <div class="flex items-center gap-3 mb-3">
                                            <span class="px-3 py-1 rounded-lg bg-white border border-slate-200 font-mono text-sm">
                                                @item.QuantityBefore.Value.ToString("N2")
                                            </span>
                                            <i class="bi bi-arrow-right text-slate-400"></i>
                                            <span class="px-3 py-1 rounded-lg bg-white border border-slate-200 font-mono text-sm font-bold">
                                                @item.QuantityAfter.Value.ToString("N2")
                                            </span>
                                            @{
                                                var diff = item.QuantityAfter.Value - item.QuantityBefore.Value;
                                                if (diff != 0)
                                                {
                                                    var diffColor = diff > 0 ? "text-green-600" : "text-red-600";
                                                    var diffSign = diff > 0 ? "+" : "";
                                                    <span class="@diffColor font-semibold text-sm">
                                                        (@diffSign@diff.ToString("N2"))
                                                    </span>
                                                }
                                            }
                                        </div>
                                    }

                                    @if (!string.IsNullOrEmpty(item.Notes))
                                    {
                                        <p class="text-sm text-slate-600 mb-3">
                                            <i class="bi bi-chat-left-text me-1"></i>
                                            @item.Notes
                                        </p>
                                    }

                                    @if (!string.IsNullOrEmpty(item.RelatedLotIds))
                                    {
                                        <p class="text-xs text-slate-500">
                                            <i class="bi bi-link-45deg me-1"></i>
                                            Related: <span class="font-mono">@item.RelatedLotIds</span>
                                        </p>
                                    }

                                    <div class="mt-3 pt-3 border-t border-slate-200">
                                        <p class="text-xs text-slate-500">
                                            <i class="bi bi-person me-1"></i>
                                            Bởi <strong>@item.PerformedBy</strong>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-12 text-center">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-slate-100 mb-4">
                <i class="bi bi-inbox text-slate-400 text-4xl"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-2">Chưa có lịch sử</h3>
            <p class="text-slate-600">Lô này chưa có hoạt động nào được ghi nhận</p>
        </div>
    }
</div>






















































